{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,S,aAGA,MAAMC,EAAaC,SAASC,cAAc,oBACpCC,EAAcF,SAASC,cAAc,sBACrCE,EAAiBC,KAAKC,MAAMC,aAAaC,QAAQ,aAEvD,IAAIC,EAAkB,GAClBC,EAAe,EAanBC,eAAeC,IACb,IACE,IAAKR,EACH,OAEF,MAAMS,EAAeJ,EAAgBC,GAC/BI,QAAa,EAAAhB,EAAAiB,mBAAkBF,GAC/BG,QAAsB,EAAAlB,EAAAmB,6BAElBD,EAnBLE,SAAQC,IACb,MAAMC,EAAanB,SAASoB,cAAc,UAC1CD,EAAWE,MAAQH,EAAMI,KACzBH,EAAWI,YAAcL,EAAMI,KAC/BH,EAAWK,UAAUC,IAAI,gBACzBvB,EAAYwB,OAAOP,EAAW,IAgB9BjB,EAAYyB,iBAAiB,UAAUC,IACrC,MAAMC,EAAgBD,EAAIE,OAAOT,MAEjC,GAAsB,UAAlBQ,EACF9B,EAAWgC,UAAY,GACvBhC,EAAWiC,mBAAmB,YAAaC,EAAoBpB,IAE3DJ,EAAeD,EAAgB0B,SACjCnC,EAAWiC,mBAAmB,YAAaG,KAC3CC,SAEG,CACL,MAAMC,EAAiBxB,EAAKyB,QAAOC,IACjC,MAAMC,EAAcD,EAAME,OAAOC,MAC/BxB,GAASA,EAAMI,OAASO,IAG1B,OADAc,QAAQC,IAAIf,GACLW,CAAW,IAEpBzC,EAAWgC,UAAY,GACvBhC,EAAWiC,mBACT,YACAC,EAAoBI,G,KAK1B5B,IAEAV,EAAWiC,mBAAmB,YAAaC,EAAoBpB,IAE3DJ,EAAeD,EAAgB0B,QACjCnC,EAAWiC,mBAAmB,YAAaG,KAE7CC,IACAO,QAAQC,IAAI/B,E,CACZ,MAAOgC,GACPF,QAAQC,IAAIC,E,EAIhB,SAAST,IACP,MAAMU,EAAa9C,SAASC,cAAc,aACpC8C,EAAqB/C,SAASgD,iBAAiB,aAEhDF,GAGLA,EAAWnB,iBAAiB,SAAS,KAC/BlB,EAAeD,EAAgB0B,SACjCa,EAAmB9B,SAAQgC,GAAUA,EAAOC,WAC5CvC,I,IAKN,SAASsB,EAAoBkB,GAC3B,OAAOA,EACJC,KAAIb,IACH,MAAMc,aAAEA,EAAYC,cAAEA,EAAab,OAAEA,EAAMc,MAAEA,EAAKC,aAAEA,GAClDjB,EAEIkB,EADchB,EAAOiB,MAAM,EAAG,GACNN,KAAIlC,GAASA,EAAMI,OAAMqC,KAAK,MAE5D,MAAO,4JACwGL,4LA+B9G,SAAmCM,GAEZ,MAAtBC,EAAaD,EAAU,GAAM,IAKnC,OAF0BE,KAAKC,MAAmB,IAAbF,GAAoB,G,CAjCYG,CACzCR,6xBAY4BD,0EACEE,gDAAwDJ,EAAaK,MACzH,EACA,mGAKO,IAEVC,KAAK,G,CAeV,SAASxB,IACP,GAAI3B,EAAgB0B,OAAS,EAC3B,MAAO,yE,EAKX,SAA8BiB,GAC5B,IAAKA,EACH,OAGF,KAAOA,EAAIjB,OAAS,GAEW,IAA3B1B,EAAgB0B,QACuC,IAAvD1B,EAAgBA,EAAgB0B,OAAS,GAAGA,QAE5C1B,EAAgByD,KAAK,IAEvBzD,EAAgBA,EAAgB0B,OAAS,GAAG+B,KAAKd,EAAIe,Q,CA1IzDC,CAAqBhE,GA2GrBQ","sources":["src/js/library.js"],"sourcesContent":["import { libraryMovieQuery } from './apikey';\nimport { upcomingMovieGenreRequest } from './apikey';\n\nconst libraryBox = document.querySelector('.library-js-list');\nconst selectGenre = document.querySelector('#js-library-select');\nconst localStorageId = JSON.parse(localStorage.getItem('movieIds'));\n\nlet localStorageArr = [];\nlet currentIndex = 0;\n\nfunction getGenres(genres) {\n  genres.forEach(genre => {\n    const optionElem = document.createElement('option');\n    optionElem.value = genre.name;\n    optionElem.textContent = genre.name;\n    optionElem.classList.add('optionSelect');\n    selectGenre.append(optionElem);\n  });\n}\nserviceArrPagination(localStorageId);\n\nasync function initLibraryFetch() {\n  try {\n    if (!localStorageId) {\n      return;\n    }\n    const currentArray = localStorageArr[currentIndex];\n    const data = await libraryMovieQuery(currentArray);\n    const libraryGenres = await upcomingMovieGenreRequest();\n\n    getGenres(libraryGenres);\n\n    selectGenre.addEventListener('change', evt => {\n      const selectedGenre = evt.target.value;\n\n      if (selectedGenre === 'Genre') {\n        libraryBox.innerHTML = '';\n        libraryBox.insertAdjacentHTML('beforeend', createLibraryMarkup(data));\n\n        if (currentIndex < localStorageArr.length) {\n          libraryBox.insertAdjacentHTML('beforeend', btnMarkup());\n          servicePagination();\n        }\n      } else {\n        const filteredMovies = data.filter(movie => {\n          const genreOption = movie.genres.some(\n            genre => genre.name === selectedGenre\n          );\n          console.log(selectedGenre);\n          return genreOption;\n        });\n        libraryBox.innerHTML = '';\n        libraryBox.insertAdjacentHTML(\n          'beforeend',\n          createLibraryMarkup(filteredMovies)\n        );\n      }\n    });\n\n    currentIndex++;\n\n    libraryBox.insertAdjacentHTML('beforeend', createLibraryMarkup(data));\n\n    if (currentIndex < localStorageArr.length) {\n      libraryBox.insertAdjacentHTML('beforeend', btnMarkup());\n    }\n    servicePagination();\n    console.log(data);\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nfunction servicePagination() {\n  const libraryBtn = document.querySelector('.loadMore');\n  const libraryMoreButtons = document.querySelectorAll('.loadMore');\n\n  if (!libraryBtn) {\n    return;\n  }\n  libraryBtn.addEventListener('click', () => {\n    if (currentIndex < localStorageArr.length) {\n      libraryMoreButtons.forEach(button => button.remove());\n      initLibraryFetch();\n    }\n  });\n}\n\nfunction createLibraryMarkup(arr) {\n  return arr\n    .map(movie => {\n      const { release_date, backdrop_path, genres, title, vote_average } =\n        movie;\n      const genreSliced = genres.slice(0, 1);\n      const genreName = genreSliced.map(genre => genre.name).join(', ');\n\n      return `<div class=\"library-container-item\">\n                <div class=\"library-container-img\" style=\"background-image: url(https://image.tmdb.org/t/p/original${backdrop_path});\">\n                <div class=\"rating-libr rating-library\">\n                        <div class=\"rating-body\">\n                            <div class=\"rating-active\" style=\"width: ${convertRatingToPercentage(\n                              vote_average\n                            )}%;\"></div>\n                            <div class=\"rating-items\">\n                                <input type=\"radio\" class=\"reting-item\" value=\"1\" name=\"rating\"></>\n                                <input type=\"radio\" class=\"reting-item\" value=\"2\" name=\"rating\"></>\n                                <input type=\"radio\" class=\"reting-item\" value=\"3\" name=\"rating\"></>\n                                <input type=\"radio\" class=\"reting-item\" value=\"4\" name=\"rating\"></>\n                                <input type=\"radio\" class=\"reting-item\" value=\"5\" name=\"rating\"></>\n                            </div>\n                            </div>\n                        </div>\n                    <div class=\"library-container-about\">\n                        <h3 class=\"library-movie-title\">${title}</h3>     \n                        <span class=\"library-genre-title\">${genreName}</span><span class=\"library-genre-title\"> | ${release_date.slice(\n        0,\n        4\n      )}</span>   \n                    </div> \n            </div>\n            </div>\n        </div>`;\n    })\n    .join('');\n}\n\ninitLibraryFetch();\n\nexport function convertRatingToPercentage(rating) {\n  // Перетворюємо рейтинг у відсотки\n  const percentage = (rating / 10) * 100;\n\n  // Округлюємо значення до двох знаків після коми\n  const roundedPercentage = Math.round(percentage * 100) / 100;\n\n  return roundedPercentage;\n}\n\nfunction btnMarkup() {\n  if (localStorageArr.length > 1) {\n    return `<button type=\"button\" class=\"loadMore loadMoreStyle\">Load more</button>`;\n  } else {\n  }\n}\n\nfunction serviceArrPagination(arr) {\n  if (!arr) {\n    return;\n  }\n\n  while (arr.length > 0) {\n    if (\n      localStorageArr.length === 0 ||\n      localStorageArr[localStorageArr.length - 1].length === 9\n    ) {\n      localStorageArr.push([]);\n    }\n    localStorageArr[localStorageArr.length - 1].push(arr.shift());\n  }\n}\n"],"names":["$3iMKl","parcelRequire","$1cafa503bc57b7a0$var$libraryBox","document","querySelector","$1cafa503bc57b7a0$var$selectGenre","$1cafa503bc57b7a0$var$localStorageId","JSON","parse","localStorage","getItem","$1cafa503bc57b7a0$var$localStorageArr","$1cafa503bc57b7a0$var$currentIndex","async","$1cafa503bc57b7a0$var$initLibraryFetch","currentArray","data","libraryMovieQuery","libraryGenres","upcomingMovieGenreRequest","forEach","genre","optionElem","createElement","value","name","textContent","classList","add","append","addEventListener","evt","selectedGenre","target","innerHTML","insertAdjacentHTML","$1cafa503bc57b7a0$var$createLibraryMarkup","length","$1cafa503bc57b7a0$var$btnMarkup","$1cafa503bc57b7a0$var$servicePagination","filteredMovies","filter","movie","genreOption","genres","some","console","log","err","libraryBtn","libraryMoreButtons","querySelectorAll","button","remove","arr","map","release_date","backdrop_path","title","vote_average","genreName","slice","join","rating","percentage","Math","round","$1cafa503bc57b7a0$export$ee3a79a376c3be13","push","shift","$1cafa503bc57b7a0$var$serviceArrPagination"],"version":3,"file":"library.6a5be0b9.js.map"}